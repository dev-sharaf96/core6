<div class="row">
  <div class="col-xs-12">
    <h4 class="page-header">{{ "navbar.requests" | translate }}</h4>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading" translate>common.filter_by</div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-3">
            <div class="form-group">
              <label for="" translate> RepeatedPolicies.repeatedItem</label>
              <p-dropdown
                [options]="repeatedItem"
                [style]="{ width: '100%' }"
                optionLabel="label"
                (onChange)="changed($event)"
                placeholder="Select value"
              >
              </p-dropdown>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12 col-md-6">
            <div class="row">
              <div class="col-md-6">
                <label for="fdate"
                  >{{ "serviceRequests.date" | translate }}
                  {{ "common.from" | translate }}</label
                >
                <div class="form-group">
                  <p-calendar
                    [(ngModel)]="requestsFilter.startDate"
                    [showIcon]="true"
                    [placeholder]="'common.from' | translate"
                    [maxDate]="requestsFilter.endDate || today"
                    styleClass="w-100"
                    inputStyleClass="form-control"
                  ></p-calendar>
                </div>
              </div>
              <div class="col-md-6">
                <label for="fdate"
                  >{{ "serviceRequests.date" | translate }}
                  {{ "common.to" | translate }}</label
                >
                <div class="form-group">
                  <p-calendar
                    [(ngModel)]="requestsFilter.endDate"
                    [showIcon]="true"
                    [placeholder]="'common.to' | translate"
                    [minDate]="requestsFilter.startDate"
                    [maxDate]="today"
                    styleClass="w-100"
                    inputStyleClass="form-control"
                  ></p-calendar>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-6">
            <div class="row">
              <div class="col-xs-12 col-md-6">
                <button
                  (click)="filterClick(policiesTable)"
                  [disabled]="Isloading || status"
                  class="btn btn-primary"
                  style="margin-top: 20px"
                  translate
                >
                  common.search
                  <i class="fa fa-spinner fa-spin" *ngIf="Isloading"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <br />
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row" [ngClass]="{ hidden: firstTime }">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <a (click)="exportCsv()" class="pointer" translate>common.export</a>
        <div class="text-left clearfix">
          {{ "common.results_count" | translate }} : {{ RepeatedPoliciesCount }}
        </div>
      </div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <p-table
          #policiesTable
          [value]="allRepeatedPolicies"
          [lazy]="true"
          (onLazyLoad)="repeatedPoliciesLazyLoad($event)"
          [lazyLoadOnInit]="false"
          [totalRecords]="RepeatedPoliciesCount"
          [resetPageOnSort]="true"
          [rowsPerPageOptions]="[5, 10, 20]"
          [loading]="loading"
          [paginator]="true"
          [rows]="10"
          [responsive]="true"
          scrollHeight="200px"
          [autoLayout]="true"
          [resizableColumns]="true"
        >

          <ng-template pTemplate="header">
            <tr>
              <th translate>RepeatedPolicies.reference_id</th>
              <th translate>RepeatedPolicies.policyIssueDate</th>
              <th translate>RepeatedPolicies.insured_NIN</th>
              <th translate>RepeatedPolicies.Name</th>
              <th translate>RepeatedPolicies.Phone</th>
              <th translate>RepeatedPolicies.IBAN</th>
              <th translate>RepeatedPolicies.vehicleOwnerId</th>
              <th translate>RepeatedPolicies.Sequence_Custom_Number</th>
              <th translate>RepeatedPolicies.channel</th>
              <!-- <th translate>common.action</th> -->
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-request>
            <tr>
              <td style="word-wrap: break-word">
                {{ request.referenceId }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.policyIssueDate }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.nationalId }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.fullNmae | translate}}
              </td>
              <td style="word-wrap: break-word">
                {{ request.phone }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.iBAN }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.insuredNin }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.vehicleId }}
              </td>
              <td style="word-wrap: break-word">
                {{ request.channel }}
              </td>
              <!-- <td style="word-wrap: break-word; text-align: center">
                <button
                  type="button"
                  class="btn btn-secondary action-btn"
                  (click)="showDetails(request)"
                  translate
                >
                  policy.details
                </button>
              </td> -->
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td style="text-align: center">
                {{ "common.noRecordsFound" | translate }}
              </td>
            </tr>
          </ng-template>
        </p-table>
        <!-- /.table-responsive -->
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<!-- <app-loader *ngIf="firstTime"></app-loader> -->

<p-dialog
  [(visible)]="selectedRequest"
  [modal]="true"
  [responsive]="true"
  [minY]="70"
  [baseZIndex]="10000"
  [dismissableMask]="true"
  [rtl]="!isEnglish"
>
  <div *ngIf="selectedRequest">
    <div class="info-row">
      <h4 class="">{{ "serviceRequests.serviceRequest" | translate }}:</h4>
      <p class="">{{ selectedRequest.serviceRequest || emptyStringValue }}</p>
    </div>
    <div class="info-row">
      <h4 class="">{{ "serviceRequests.serviceResponse" | translate }}:</h4>
      <p class="">{{ selectedRequest.serviceResponse || emptyStringValue }}</p>
    </div>
  </div>
</p-dialog>
 